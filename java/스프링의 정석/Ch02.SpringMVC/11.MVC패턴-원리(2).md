# 스프링의 정석
- 2022.05.01(일)
- 강의 목표: Spring의 기본 원리 이해, Spring으로 웹 사이트 구축 & AWS 배포
- 강의 자료: https://github.com/castello/spring_basic
- 강의 진도 
	- Ch0211. 관심사의 분리와 MVC패턴 - 원리(2)

<br>

## 관심사의 분리와 MVC패턴 - 원리(2)
- Spring MVC패턴이 어떠한 원리로 동작하는지에 대해 예제를 통해 단계별로 알아보자
- 소제목에 해당하는 파일을 깃허브에서 받아와 원리를 확인한다

<br>

### MethodCall2.java
- 전체 코드: https://github.com/castello/spring_basic/blob/main/ch2/MethodCall2.java

```java
// mainMethod
Class clazz = Class.forName("com.study.jinsook.YoiltellerMVC");
Object obj = clazz.newInstance();
```
1. YoilTellerMVC 객체 생성 		

<br>

```java
Method main = clazz.getDeclaredMethod("main", int.class, int.class, int.class, Model.class); //2
Model model = new BindingAwareModelMap(); // 3
```
2. 메인 메서드의 정보를 가져오기
	- 같은 이름의 메서드가 있을 수 있으므로, `getDeclaredMethod()`의 인자로 메서드명과 정보를 가져올 메서드의 매개변수를 모두 적어준다 
	- 인자에 적은 내용을 토대로 클래스로부터 메서드의 정보를 가져온다 
3. Model(interface)을 생성한다

<br>

```java
String viewName = (String)main.invoke(obj, new Object[] {2022,5,1,model});
```
4. 메인 메서드를 호출한다
	- Reflection API를 사용할 때는 `invoke()` 메서드를 통해 호출한다
		- `main.invoke(obj .. )` : obj라는 객체의 main메서드를 호출한다.
		- `main.invoke(.. new Object[] {...})` : 메서드의 매개변수를 배열로 받아온다 
	- Reflection API를 사용하지 않을 때는 `String viewName = obj.main(2022, 5, 1, model);` 의 형태로 호출한다

<br>

```java
	... 
	render(model, viewName);
} // main

static void render(Model model, String viewName) throws IOException {
		String result = "";
		//5-1. 뷰의 내용을 한줄씩 읽어서 하나의 문자열로 만든다.
		Scanner sc = new Scanner(new File("src/main/webapp/WEB-INF/views/"+viewName+".jsp"), "utf-8");
		while(sc.hasNextLine()){
			result += sc.nextLine()+ System.lineSeparator();
		}
		//5-2. model을 map으로 변환 
		Map map = model.asMap();		
		//5-3.key를 하나씩 읽어서 template의 ${key}를 value바꾼다.
		Iterator it = map.keySet().iterator();
		while(it.hasNext()) {
			String key = (String)it.next();
			//5-4. replace()로 key를 value 치환한다.
			result = result.replace("${"+key+"}", ""+map.get(key));
		}		
		//5-5.렌더링 결과를 출력한다.
		System.out.println(result);
}
```
5. `render(모델, 뷰)` 을 통해 모델에 담긴 내용을 뷰에 전달한다

<br>

### MethodCall3.java
- 전체 코드: https://github.com/castello/spring_basic/blob/main/ch2/MethodCall3.java

<br>

