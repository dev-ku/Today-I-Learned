# 스프링의 정석
- 2022.05.01(일)
- 강의 목표: Spring의 기본 원리 이해, Spring으로 웹 사이트 구축 & AWS 배포
- 강의 자료: https://github.com/castello/spring_basic
- 강의 진도 
	- Ch0210. 관심사의 분리와 MVC패턴 - 실습

<br>

## 관심사의 분리와 MVC패턴 - 실습 (YoilTellerMVC.java)
- `YoilTeller.java` 를 복사하여 MVC패턴을 적용한다
- 입력: 매개변수로 필요한 데이터 타입의 형태로 받아온다
- 처리(Controller): 매개변수를 사용해 처리한다
- 출력(View): view를 위한 jsp를 `프로젝트/src/main/webapp/WEB-INF/views`에 작성한다 
	- `yoil.jsp`: 유효성 검사에서 문제가 없었다면 보여질 view
	- `yoilError.jsp`: 유효성 검사에서 문제가 있다면 보여질 ErrorView

### 입력 및 처리
```java
package com.study.jinsook;

import java.io.IOException;
import java.io.PrintWriter;
import java.util.Calendar;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.RequestMapping;

// (1) 프로그램 등록 
@Controller 
public class YoilTellerMVC {
	// (2) URL 매핑 : http://localhost:8080/jinsook/getYoilMVC?year=2022&month=4&day=1
	@RequestMapping("/getYoilMVC")
	public static String main(int year, int month, int day, Model model) throws IOException {
		// 유효성 검사
		if(!isValid(year, month, day)) return "yoilError";
		
		// 2. 처리 
		char yoil = getYoil(year, month, day);
		
		// Model에 담기
		model.addAttribute("year", year);
		model.addAttribute("month", month);
		model.addAttribute("day", day);
		model.addAttribute("yoil", yoil);
		
		// 3. 출력: 프로젝트/src/main/webapp/WEB-INF/views 에 jsp파일로 작성
		return "yoil";
	}

	private static boolean isValid(int year, int month, int day) {
		return true;
	}

	private static char getYoil(int year, int month, int day) {
		Calendar cal = Calendar.getInstance();
		cal.set(year, month-1, day);
		
		int dayOfWeek = cal.get(Calendar.DAY_OF_WEEK);
		return " 일월화수목금토".charAt(dayOfWeek);
	}
}
```
- 특정 코드를 메서드로 분리할 때는 해당 코드를 블럭처리하고, 우클릭 → Refactor → Extract Class 하면 된다
- 유효성 검사를위한 `isValid()`와 요일을 알아내는 `getYoil()` 메서드는 클래스 내부에서만 사용할 예정이므로 `private`으로 만든다

<br>

### 출력 (yoil.jsp)
```jsp
<%@ page contentType="text/html;charset=utf-8" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ page session="false" %>

<html>
	<head>
		<title>YoilTellerMVC</title>
	</head>
	<body>
		<h1>${year}년 ${month}월 ${day}일은 ${yoil}요일 입니다</h1>
	<body>
</html>
```
- encoding 관련 내용이 없으면 브라우저에서 실행될 때 깨져서 보인다
	- `<%@ page contentType="text/html;charset=utf-8" %>`
- `${}` 의 형태로 값을 받아와 사용하는 것을 `EL(Expression Language)` 이라고 말한다
- [참고] 만약 작성하는데 오류가 발생한다면, 작성한 코드를 잠시 잘라내기한 후 저장한다. 저장 후 붙여넣기 하면 오류가 사라진다


<br>

### Error 출력 (yoilError.jsp)

```jsp
<%@ page contentType="text/html;charset=utf-8" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ page session="false" %>

<html>
	<head>
		<title>YoilTellerMVC</title>
	</head>
	<body>
		<h1>잘못된 요청입니다</h2>
		<h1>year, month, day를 모두 올바른 값으로 입력하십시오</h1>
	<body>
</html>
```